<!DOCTYPE html>

<head>
    <title>TREAC - The Treadmill Controller</title>

    <style>
        .noUi-horizontal {
            width: 800px;
        }
        .noUi-vertical {
            height: 150px;
        }
    </style>

    <link href="/static/nouislider.min.css" rel="stylesheet">
    <script src="/static/nouislider.min.js" data-cover></script>

  <style>
    .circle {
        border-radius: 50%;

        width: 300px;
        height: 300px;
        padding: 8px;

        background: #fff;
        border: 2px solid #666;
        color: #666;
        text-align: center;
        margin: 0 auto;
    }

    .dashboard {
        width: 800px;
        margin: 0 auto;
        text-align: center;
    }

    body {
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .header {
        margin-top: 30px;
        margin-bottom: 30px;
        font: 32px Arial, sans-serif;
    }

    #speed {
        margin-top: 50px;
        font: 64px Arial, sans-serif;
    }

    #speed-slider {
        margin-top: 20px;
    }
  </style>

</head>

<body>
  <div class="header">
  TREAC
  </div>
  <div class="dashboard">
    <div class="circle">
        <div id="speed">0.0</div>
    </div>
    <div id="speed-slider">
    </div>
  </div>
<script>
var softSlider = document.getElementById('speed-slider');

noUiSlider.create(softSlider, {
    start: 0,
    connect: 'lower',
    step: 1,
    range: {
        min: 0,
        max: 90
    },
    pips: {
        mode: 'values',
        values: [10, 20, 30, 40, 50, 60, 70, 80],
        density: 1
    },
    format: {
        to: function ( value ) {
            var newValue = value / 10.0;
            return newValue.toFixed(1);
        },
        from: function ( value ) {
            return value;
        }
    }
});
softSlider.noUiSlider.on('change', function ( values, handle, unencodedValues ) {
    if ( unencodedValues[handle] < 10 ) {
        softSlider.noUiSlider.set(0);
    }
    if ( unencodedValues[handle] > 80 ) {
        softSlider.noUiSlider.set(80);
    }
});
softSlider.noUiSlider.on('update', function ( values, handle ) {
    var value = values[handle];
    document.getElementById('speed').textContent = value
});
softSlider.noUiSlider.on('set', function ( values, handle, unencodedValues ) {
    var value = unencodedValues[handle];
    if ( value < 10 && value > 0 || value > 80) {
        return;
    }
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status != 200) {
            alert(xmlHttp.responseText);
        }
    }
    xmlHttp.open( "GET", "/speed/" + value, true );
    xmlHttp.send( null );
});
</script>
</body>
